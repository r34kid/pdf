<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Tinder Demo</title>
<link rel="apple-touch-icon" href="https://images4-a.ravelrycache.com/uploads/SassyK459/158403116/IMG_1688_medium2.JPG">

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}

html, body {
  height: 100%;
  overflow: hidden;
  background: #121212;
}

#app {
  position: relative;
  margin: 5px auto 0 auto;
  width: 98%;
  height: 90vh;
  overflow: hidden;
}

/* Стек карточек */
.card-stack {
  position: relative;
  width: 100%;
  height: 100%;
}

.card {
  position: absolute;
  width: 100%;
  height: 100%;
  background-size: cover;
  background-position: center;
  transition: transform 0.4s ease, opacity 0.4s ease;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: 20px;
  border-radius: 25px;
  overflow: hidden;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}

/* Текущая карточка */
.card.current {
  z-index: 10;
  cursor: grab;
}

.card.current:active {
  cursor: grabbing;
}

.card::before {
  content: "";
  position: absolute;
  inset: 0;
  background:
    linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 50%),
    linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 50%);
  pointer-events: none;
}

/* Карточка под текущей */
.card.next {
  opacity: 0.8;
  z-index: 1;
  filter: blur(20px);
  -webkit-filter: blur(20px);
}

/* Эффект при свайпе */
.card.current.swiping + .card.next {
  filter: blur(10px);
  opacity: 0.9;
}

.overlay-like, .overlay-dislike {
  position: absolute;
  inset: 0;
  opacity: 0;
  transition: opacity 0.2s;
  pointer-events: none;
}

.overlay-like { background: rgba(0,255,0,0.3); }
.overlay-dislike { background: rgba(255,0,0,0.3); }

.top { z-index: 2; }

.photo-indicators {
  display: flex;
  gap: 4px;
  margin-bottom: 8px;
}

.photo-indicators div {
  flex: 1;
  height: 2px;
  background: rgba(255,255,255,0.4);
  border-radius: 2px;
}

.photo-indicators .active {
  background: white;
}

.distance {
  margin-top: 10px;
  color: white;
  font-size: 1em;
}

.bottom { z-index: 2; }

.name {
  color: white;
  font-size: 2em;
  font-weight: 600;
  margin-bottom: 20px;
}

.tags {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-bottom: 10px;
}

.tag {
  background: rgba(50,50,50,0.7);
  color: rgba(255,255,255,0.9);
  padding: 6px 10px;
  border-radius: 20px;
  font-size: 0.9em;
}

.description {
  color: white;
  font-size: 0.9em;
  margin-bottom: 5px;
  white-space: pre-line;
  /* line-height: 0.5; */
}

.buttons {
  display: flex;
  gap: 8px;
}

.btn {
  flex: 1;
  padding: 14px 0;
  border-radius: 45px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  backdrop-filter: blur(4px);
}

.btn svg {
  width: 26px;
  height: 26px;
  display: block;
}

.menu-item {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
  color: #888;
}

.menu-item svg {
  width: 28px;
  height: 28px;
  display: block;
}

.dislike { background: rgba(255,0,0,0.3); }
.superlike { background: rgba(0,100,255,0.3); }
.like { background: rgba(0,200,0,0.3); }

/* Нижнее меню */
.bottom-menu {
  height: 10vh;
  background: #121212;
  display: flex;
  justify-content: space-around;
  align-items: center;
  font-size: 32px;
}

.menu-item {
  color: #888;
  margin-bottom: 20px;
}

.menu-item.active {
  color: #1e90ff;
}

.btn svg {
  width: 100%;
  height: 100%;
  max-width: 28px;
  max-height: 28px;
  display: block;
}

.btn.dislike svg {
  width: 85%;
  height: 85%;
  max-width: 27px;
  max-height: 27px;
  display: block;
}

/* Контейнер описания */
.description-container {
  position: relative;
  margin-bottom: 15px;
  max-height: 4.5em;
  overflow: hidden;
  transition: max-height 0.3s ease;
}

.description-container.expanded {
  max-height: 500px;
  margin-bottom: 5px;
}

.description {
  color: white;
  font-size: 1em;
  line-height: 1.5;
  white-space: pre-line;
}

/* Кнопка "показать полностью" */
.show-more-btn {
  color: #a1a1a1;
  font-size: 0.8em;
  cursor: pointer;
  margin-bottom: 2px;
  transition: background 0.2s;
  width: fit-content;
  z-index: 20;
  margin: 0;
  padding: 0;
}

.show-more-btn:hover {
  background: rgba(255,255,255,0.3);
}

/* Индикатор градиента для обрезанного текста */
.description-container:not(.expanded)::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 2em;
  pointer-events: none;
}

button {
  background: none;
  border: none;
  color: white;
  padding: 8px 0;
  font-size: 0.9em;
  cursor: pointer;
  margin-top: 8px;
  margin-bottom: 8px;
  width: fit-content;
  z-index: 20;
  outline: none;
  box-shadow: none;
  text-decoration: none;
  transform: none;
}

/* Убираем все выделения с кнопок */
button,
button *,
button:active,
button:focus,
button:hover,
button:visited {
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  outline: none !important;
  box-shadow: none !important;
  text-shadow: none !important;
  background: none;
  border: none;
}

/* Убираем стандартный outline для всех элементов */
*:focus {
  outline: none !important;
  box-shadow: none !important;
}

/* Для кнопки "показать полностью" */
button {
  background: none;
  border: none;
  color: white;
  font-size: 0.9em;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  outline: none;
  box-shadow: none;
}

/* Убираем серый фон при тапе на мобильных */
button:active {
  background: none !important;
  -webkit-tap-highlight-color: transparent;
}

button {
  -webkit-tap-highlight-color: transparent;
  touch-action: manipulation;
}

.show-more-btn {
  gap: 0px;
  margin-bottom: 10px;
}

/* Стили для мэтча */
.match-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgb(29, 29, 29, 0.8);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  z-index: 1000;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  animation: matchAppear 0.5s ease;
}

@keyframes matchAppear {
  from {
    opacity: 0;
    transform: scale(0.8);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.match-content {
  text-align: center;
  padding: 20px;
}

.match-title {
  color: #fff;
  font-size: 3em;
  font-weight: bold;
  margin-bottom: 20px;
  text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.match-photo {
  width: 300px;
  height: 300px;
  border-radius: 50%;
  object-fit: cover;
  border: 4px solid #fff;
  box-shadow: 0 0 50px rgba(255, 255, 255, 0.3);
  margin-bottom: 30px;
  margin-top: 70px;
}

.match-name {
  color: #fff;
  font-size: 2em;
  margin-bottom: 0px;
  /* margin-top: 45px; */
  margin-bottom: 10px;
}

.match-message {
  color: #888;
  font-size: 1.2em;
  margin-bottom: 40px;
}

.match-close-btn {
  background: rgba(255, 0, 0, 0.2);
  color: white;
  border: none;
  padding: 15px 40px;
  width: 70%;
  border-radius: 30px;
  font-size: 1.2em;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 0 20px rgba(30, 144, 255, 0.5);
}

.match-close-btn:hover {
  transform: scale(1.05);
  background: #0077ea;
}

.match-close-btn:active {
  transform: scale(0.95);
}

.hidden {
  display: none !important;
}

.match-badge {
  position: absolute;
  top: 20px;
  right: 20px;
  background: #1e90ff;
  color: white;
  padding: 5px 15px;
  border-radius: 20px;
  font-size: 0.9em;
  z-index: 20;
  box-shadow: 0 0 15px rgba(30, 144, 255, 0.5);
  animation: pulse 2s infinite;
}

</style>
</head>
<body>
<script src="profiles.js"></script>
<div id="app"></div>

<div class="bottom-menu">
  <div class="menu-item active" onclick="showMatches()">
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><title>Stacked-scrolling-1 SVG Icon</title><path d="M18 30H4a2 2 0 0 1-2-2V14a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2zM4 14v14h14V14z" fill="currentColor"/><path d="M25 23h-2V9H9V7h14a2 2 0 0 1 2 2z" fill="currentColor"/><path d="M30 16h-2V4H16V2h12a2 2 0 0 1 2 2z" fill="currentColor"/></svg>
  </div>
  <div class="menu-item" onclick="showLikes()">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48"><title>Like SVG Icon</title><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="4" d="M15 8C8.925 8 4 12.925 4 19c0 11 13 21 20 23.326C31 40 44 30 44 19c0-6.075-4.925-11-11-11c-3.72 0-7.01 1.847-9 4.674A10.987 10.987 0 0 0 15 8"/></svg>
  </div>
  <div class="menu-item" onclick="showMessages()">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><title>Message-rounded SVG Icon</title><path fill="currentColor" d="M12 2C6.486 2 2 5.589 2 10c0 2.908 1.898 5.516 5 6.934V22l5.34-4.005C17.697 17.852 22 14.32 22 10c0-4.411-4.486-8-10-8m0 14h-.333L9 18v-2.417l-.641-.247C5.67 14.301 4 12.256 4 10c0-3.309 3.589-6 8-6s8 2.691 8 6s-3.589 6-8 6"/></svg>
  </div>
  <div class="menu-item" onclick="showProfile()">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><title>Profile SVG Icon</title><g fill="none" stroke="currentColor" stroke-width="2"><path stroke-linejoin="round" d="M4 18a4 4 0 0 1 4-4h8a4 4 0 0 1 4 4a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2z"/><circle cx="12" cy="7" r="3"/></g></svg>
  </div>
</div>

<!-- Оверлей мэтча -->
<div id="matchOverlay" class="match-overlay hidden">
  <div class="match-content">
    <div class="match-title">ЭТО МЭТЧ!</div>
    <img id="matchPhoto" class="match-photo" src="" alt="Match photo">
    <div id="matchName" class="match-name"></div>
    <!-- <div class="match-message">Вы понравились друг другу</div> -->
    <button class="match-close-btn" onclick="closeMatch()">Написать сообщение</button>
    <button class="match-close-btn" style="margin-top: 10px; border: 2px solid rgba(102, 102, 102, 0.3); background: none" onclick="closeMatch()">Вернуться к поиску</button>
  </div>
</div>

<script src="profiles.js"></script>
<script>
let currentProfileIndex = 0;
let currentPhotoIndex = 0;
let profilesList = [];
let isAnimating = false;
let matches = []; // Массив для хранения мэтчей

const app = document.getElementById("app");

// Инициализация
profilesList = profiles;

// Загружаем мэтчи из localStorage
function loadMatches() {
  const savedMatches = localStorage.getItem('tinderMatches');
  if (savedMatches) {
    matches = JSON.parse(savedMatches);
  }
}

// Сохраняем мэтчи в localStorage
function saveMatches() {
  localStorage.setItem('tinderMatches', JSON.stringify(matches));
}

// Показать мэтч
function showMatch(profile) {
  const overlay = document.getElementById('matchOverlay');
  const matchPhoto = document.getElementById('matchPhoto');
  const matchName = document.getElementById('matchName');
  
  matchPhoto.src = profile.photos[0];
  matchName.textContent = profile.name;
  overlay.classList.remove('hidden');
}

// Закрыть мэтч
window.closeMatch = function() {
  document.getElementById('matchOverlay').classList.add('hidden');
};

// Проверка на мэтч
function checkForMatch(profile) {
  // Показываем мэтч если у профиля есть флаг is_match
  // И убираем проверку на наличие в matches, чтобы показывать при каждом просмотре
  if (profile.is_match) {
    // Проверяем, не показывали ли мы уже мэтч для этого профиля в текущей сессии
    // Добавим флаг в profile, чтобы отслеживать показ
    if (!profile.matchShown) {
      profile.matchShown = true; // Помечаем, что мэтч показан
      
      // Добавляем в matches только если там еще нет такого профиля
      if (!matches.some(m => m.name === profile.name)) {
        matches.push({
          name: profile.name,
          photo: profile.photos[0],
          timestamp: new Date().toISOString()
        });
        saveMatches();
      }
      
      showMatch(profile);
    }
  }
}

// Также нужно добавить функцию для сброса флагов при перезапуске
function resetMatchFlags() {
  profilesList.forEach(profile => {
    profile.matchShown = false; // Сбрасываем флаг показа мэтча
  });
}

// Вызовите resetMatchFlags() при инициализации
resetMatchFlags();
render();

function createCard(profile, isNext = false) {
  const card = document.createElement("div");
  card.className = `card ${isNext ? 'next' : 'current'}`;
  card.style.backgroundImage = `url(${profile.photos[isNext ? 0 : currentPhotoIndex]})`;

  const likeOverlay = document.createElement("div");
  likeOverlay.className = "overlay-like";
  const dislikeOverlay = document.createElement("div");
  dislikeOverlay.className = "overlay-dislike";

  // Верхняя часть
  const top = document.createElement("div");
  top.className = "top";

  const indicators = document.createElement("div");
  indicators.className = "photo-indicators";
  profile.photos.forEach((_, i) => {
    const bar = document.createElement("div");
    if(i === (isNext ? 0 : currentPhotoIndex)) bar.classList.add("active");
    indicators.appendChild(bar);
  });

  const distance = document.createElement("div");
  distance.className = "distance";
  distance.textContent = profile.distance;

  top.appendChild(indicators);
  top.appendChild(distance);

  // // Бейдж мэтча (если is_match = true)
  // if (profile.is_match && !isNext) {
  //   const matchBadge = document.createElement("div");
  //   matchBadge.className = "match-badge";
  //   matchBadge.textContent = "❤️ Взаимно";
  //   card.appendChild(matchBadge);
  // }

  // Нижняя часть
  const bottom = document.createElement("div");
  bottom.className = "bottom";

  const name = document.createElement("div");
  name.className = "name";
  name.textContent = profile.name;

  const tags = document.createElement("div");
  tags.className = "tags";
  profile.tags.forEach(t => {
    const tag = document.createElement("div");
    tag.className = "tag";
    tag.textContent = t;
    tags.appendChild(tag);
  });

  // Контейнер для описания
  const descContainer = document.createElement("div");
  descContainer.className = "description-container";
  
  const desc = document.createElement("div");
  desc.className = "description";
  desc.style.whiteSpace = "pre-line";
  desc.textContent = profile.description;
  
  descContainer.appendChild(desc);

  // Контейнер для кнопок
  const buttonsContainer = document.createElement("div");
  
  if (!isNext) {
    buttonsContainer.className = "buttons";
    buttonsContainer.innerHTML = `
    <div class="btn dislike">
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><title>Multiply SVG Icon</title><path fill="currentColor" d="M7.223 2.893a3.072 3.072 0 0 0-4.33 0a3.084 3.084 0 0 0 0 4.34l8.747 8.744l-8.737 8.746a3.072 3.072 0 0 0 0 4.33a3.072 3.072 0 0 0 4.33 0l8.74-8.745l8.74 8.735a3.072 3.072 0 0 0 4.33 0a3.072 3.072 0 0 0 0-4.33l-8.738-8.738l8.747-8.752a3.072 3.072 0 0 0 0-4.33c-1.2-1.19-3.15-1.19-4.34 0l-8.74 8.749z"/></svg>
    </div>
    <div class="btn superlike">
      <svg xmlns="http://www.w3.org/2000/svg" width="1024" height="1024" viewBox="0 0 1024 1024"><title>Fire-filled SVG Icon</title><path fill="currentColor" d="M834.1 469.2A347.49 347.49 0 0 0 751.2 354l-29.1-26.7a8.09 8.09 0 0 0-13 3.3l-13 37.3c-8.1 23.4-23 47.3-44.1 70.8c-1.4 1.5-3 1.9-4.1 2c-1.1.1-2.8-.1-4.3-1.5c-1.4-1.2-2.1-3-2-4.8c3.7-60.2-14.3-128.1-53.7-202C555.3 171 510 123.1 453.4 89.7l-41.3-24.3c-5.4-3.2-12.3 1-12 7.3l2.2 48c1.5 32.8-2.3 61.8-11.3 85.9c-11 29.5-26.8 56.9-47 81.5a295.64 295.64 0 0 1-47.5 46.1a352.6 352.6 0 0 0-100.3 121.5A347.75 347.75 0 0 0 160 610c0 47.2 9.3 92.9 27.7 136a349.4 349.4 0 0 0 75.5 110.9c32.4 32 70 57.2 111.9 74.7C418.5 949.8 464.5 959 512 959s93.5-9.2 136.9-27.3A348.6 348.6 0 0 0 760.8 857c32.4-32 57.8-69.4 75.5-110.9a344.2 344.2 0 0 0 27.7-136c0-48.8-10-96.2-29.9-140.9"/></svg>
    </div>
    <div class="btn like">
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24">
        <title>Heart-solid SVG Icon</title>
        <path fill="currentColor" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
      </svg>
    </div>
    `;

    // Обработчики кнопок
    const dislikeBtn = buttonsContainer.querySelector('.dislike');
    const superlikeBtn = buttonsContainer.querySelector('.superlike');
    const likeBtn = buttonsContainer.querySelector('.like');

    dislikeBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      swipeCard('left');
    });

    superlikeBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      swipeCard('up');
    });

    likeBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      swipeCard('right', profile); // Передаем профиль для проверки мэтча
    });
  }

  // Добавляем всё в bottom в правильном порядке
  bottom.appendChild(name);
  bottom.appendChild(tags);
  bottom.appendChild(descContainer);
  
  if (!isNext) {
    bottom.appendChild(buttonsContainer);
  }

  card.appendChild(likeOverlay);
  card.appendChild(dislikeOverlay);
  card.appendChild(top);
  card.appendChild(bottom);

  if (!isNext) {
    // Проверяем, нужно ли показывать кнопку "показать полностью"
    setTimeout(() => {
      checkDescriptionHeight(descContainer, buttonsContainer);
    }, 100);
    
    handleSwipe(card, likeOverlay, dislikeOverlay, profile);
    handlePhotoClick(card, profile);
  }

  return card;
}

// Функция для проверки высоты описания
function checkDescriptionHeight(descContainer, buttonsContainer) {
  const desc = descContainer.querySelector('.description');
  const lineHeight = parseInt(window.getComputedStyle(desc).lineHeight) || 20;
  const height = desc.offsetHeight;
  const maxLines = 3;
  
  if (height > lineHeight * maxLines) {
    const showMoreBtn = document.createElement('button');
    showMoreBtn.className = 'show-more-btn';
    showMoreBtn.textContent = 'Показать полностью';
    
    descContainer.parentNode.insertBefore(showMoreBtn, descContainer.nextSibling);
    
    let isExpanded = false;
    
    showMoreBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      isExpanded = !isExpanded;
      
      if (isExpanded) {
        descContainer.classList.add('expanded');
        showMoreBtn.textContent = 'Скрыть';
        buttonsContainer.classList.add('hidden');
      } else {
        descContainer.classList.remove('expanded');
        showMoreBtn.textContent = 'Показать полностью';
        buttonsContainer.classList.remove('hidden');
      }
    });
  }
}

function swipeCard(direction, profile = null) {
  if (isAnimating) return;
  isAnimating = true;

  const currentCard = document.querySelector('.card.current');
  if (!currentCard) return;

  let transform = '';
  switch(direction) {
    case 'left':
      transform = 'translateX(-1000px) rotate(-20deg)';
      break;
    case 'right':
      transform = 'translateX(1000px) rotate(20deg)';
      // Проверяем мэтч при лайке
      if (profile) {
        checkForMatch(profile);
      }
      break;
    case 'up':
      transform = 'translateY(-1000px)';
      break;
  }

  currentCard.style.transform = transform;
  currentCard.style.opacity = '0';

  setTimeout(() => {
    nextProfile();
    isAnimating = false;
  }, 300);
}

function nextProfile() {
  currentProfileIndex = (currentProfileIndex + 1) % profilesList.length;
  currentPhotoIndex = 0;
  render();
}

function render() {
  app.innerHTML = "";
  
  if (profilesList.length > 0) {
    const nextIndex = (currentProfileIndex + 1) % profilesList.length;
    const nextCard = createCard(profilesList[nextIndex], true);
    app.appendChild(nextCard);
    
    const currentCard = createCard(profilesList[currentProfileIndex], false);
    app.appendChild(currentCard);
  }
}

function handlePhotoClick(card, profile) {
  card.addEventListener("click", e => {
    if (e.target.closest('.btn')) return;
    
    if(e.clientX > window.innerWidth / 2) {
      currentPhotoIndex = (currentPhotoIndex + 1) % profile.photos.length;
    } else {
      currentPhotoIndex = (currentPhotoIndex - 1 + profile.photos.length) % profile.photos.length;
    }
    render();
  });
}

function handleSwipe(card, likeOverlay, dislikeOverlay, profile) {
  let startX = 0;
  let currentX = 0;
  let isDragging = false;

  card.addEventListener("touchstart", e => {
    if (isAnimating) return;
    startX = e.touches[0].clientX;
    isDragging = true;
    card.style.transition = 'none';
  });

  card.addEventListener("touchmove", e => {
    if(!isDragging || isAnimating) return;
    e.preventDefault();
    
    currentX = e.touches[0].clientX - startX;
    card.style.transform = `translateX(${currentX}px) rotate(${currentX/10}deg)`;

    if(currentX > 0) {
      likeOverlay.style.opacity = Math.min(currentX / 150, 0.8);
      dislikeOverlay.style.opacity = 0;
    } else {
      dislikeOverlay.style.opacity = Math.min(-currentX / 150, 0.8);
      likeOverlay.style.opacity = 0;
    }
  });

  card.addEventListener("touchend", () => {
    if (!isDragging || isAnimating) return;
    
    card.style.transition = 'transform 0.4s ease, opacity 0.4s ease';
    isDragging = false;

    if (Math.abs(currentX) > 100) {
      isAnimating = true;
      const direction = currentX > 0 ? 'right' : 'left';
      
      card.style.transform = `translateX(${currentX > 0 ? 1000 : -1000}px) rotate(${currentX/10}deg)`;
      card.style.opacity = '0';
      
      // Проверяем мэтч при свайпе вправо
      if (direction === 'right') {
        checkForMatch(profile);
      }
      
      setTimeout(() => {
        nextProfile();
        isAnimating = false;
      }, 300);
    } else {
      card.style.transform = "";
      likeOverlay.style.opacity = 0;
      dislikeOverlay.style.opacity = 0;
    }
    currentX = 0;
  });

  // Поддержка мыши
  card.addEventListener("mousedown", e => {
    if (isAnimating) return;
    e.preventDefault();
    startX = e.clientX;
    isDragging = true;
    card.style.transition = 'none';
  });

  window.addEventListener("mousemove", e => {
    if(!isDragging || isAnimating) return;
    e.preventDefault();
    
    currentX = e.clientX - startX;
    card.style.transform = `translateX(${currentX}px) rotate(${currentX/10}deg)`;

    if(currentX > 0) {
      likeOverlay.style.opacity = Math.min(currentX / 150, 0.8);
      dislikeOverlay.style.opacity = 0;
    } else {
      dislikeOverlay.style.opacity = Math.min(-currentX / 150, 0.8);
      likeOverlay.style.opacity = 0;
    }
  });

  window.addEventListener("mouseup", () => {
    if (!isDragging || isAnimating) return;
    
    card.style.transition = 'transform 0.4s ease, opacity 0.4s ease';
    isDragging = false;

    if (Math.abs(currentX) > 100) {
      isAnimating = true;
      const direction = currentX > 0 ? 'right' : 'left';
      
      card.style.transform = `translateX(${currentX > 0 ? 1000 : -1000}px) rotate(${currentX/10}deg)`;
      card.style.opacity = '0';
      
      // Проверяем мэтч при свайпе вправо
      if (direction === 'right') {
        checkForMatch(profile);
      }
      
      setTimeout(() => {
        nextProfile();
        isAnimating = false;
      }, 300);
    } else {
      card.style.transform = "";
      likeOverlay.style.opacity = 0;
      dislikeOverlay.style.opacity = 0;
    }
    currentX = 0;
  });
}

// Функции для меню (заглушки)
window.showMatches = function() {
  alert('Здесь будет список мэтчей. Сейчас их: ' + matches.length);
};

window.showLikes = function() {
  alert('Здесь будут лайки');
};

window.showMessages = function() {
  alert('Здесь будут сообщения');
};

window.showProfile = function() {
  alert('Здесь будет профиль');
};

// Проверка загрузки
if (profilesList.length === 0) {
  profilesList = [{
    name: "Тестовый профиль",
    distance: "Ошибка загрузки",
    tags: ["Проверьте", "profiles.js"],
    description: "Файл с профилями не загрузился",
    photos: ["https://picsum.photos/500/900?random=1"],
    is_match: false
  }];
}

// Загружаем сохраненные мэтчи
loadMatches();
render();
</script>

</body>
</html>
